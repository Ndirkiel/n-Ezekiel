<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>N-kiel Course Store</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root {
      --accent: #2b6cb0;
      --muted: #666;
      --card: #fff;
      --bg: #f6f8fb;
      --danger: #e53e3e;
    }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: var(--bg);
      color: #222;
    }
    .container {
      max-width: 1100px;
      margin: 24px auto;
      padding: 16px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
      flex-wrap: wrap;
      gap: 8px;
    }
    .brand { display: flex; gap: 10px; align-items: center; }
    .logo {
      width: 48px; height: 48px;
      background: linear-gradient(135deg, var(--accent), #6bb6ff);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff; font-weight: bold;
    }
    .controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    input, select {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    button {
      background: var(--accent);
      color: #fff;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button.ghost {
      background: transparent;
      color: var(--accent);
      border: 1px solid #dbeafe;
    }
    main {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 18px;
      align-items: start;
    }
    .course-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
      gap: 14px;
    }
    .card {
      background: var(--card);
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(15,23,42,0.06);
      display: flex;
      flex-direction: column;
    }
    .course-image img {
      width: 100%;
      height: 140px;
      border-radius: 8px;
      object-fit: cover;
      background: #ddd;
    }
    .course-info {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-top: 6px;
    }
    .course-title { font-weight: 600; font-size: 14px; }
    .course-instructor { font-size: 13px; color: var(--muted); }
    .price { color: var(--accent); font-weight: bold; }
    .cart {
      background: var(--card);
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(15,23,42,0.06);
      max-height: 80vh;
      overflow: auto;
    }
    .cart-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
    .cart-thumb img {
      width: 56px; height: 72px;
      border-radius: 6px; object-fit: cover;
      background: #ddd;
    }
    .total-row {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      margin-top: 10px;
    }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      max-width: 90%;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    @media (max-width: 900px) { main { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div id="app" class="container">
    <header>
      <div class="brand">
        <div class="logo">NK</div>
        <div>
          <div style="font-weight:700">N-kiel Course Store</div>
          <div style="font-size:12px;color:var(--muted)">Vue 3 Single Page Demo</div>
        </div>
      </div>
      <div class="controls">
        <input type="search" v-model="query" placeholder="Search…" />
        <select v-model="selectedCategory">
          <option value="">All categories</option>
          <option v-for="c in categories" :key="c">{{ c }}</option>
        </select>
        <select v-model="selectedSort">
          <option value="">Sort by</option>
          <option value="title">Title (A–Z)</option>
          <option value="priceAsc">Price (Low → High)</option>
          <option value="priceDesc">Price (High → Low)</option>
          <option value="ratingDesc">Rating (High → Low)</option>
        </select>
        <button @click="showAdd = true">Add Course</button>
      </div>
    </header>

    <main>
      <!-- ===== Main Course Section ===== -->
      <section>
        <div style="margin-bottom:10px;font-weight:600">{{ filteredCourses.length }} courses found</div>
        <div class="course-grid">
          <div class="card" v-for="course in filteredCourses" :key="course.id">
            <div class="course-image">
              <img :src="getImageUrl(course)" :alt="course.title" />
            </div>
            <div class="course-info">
              <div class="course-title">{{ course.title }}</div>
              <div class="course-instructor">by {{ course.instructor }}</div>
              <div class="price">{{ formatPrice(course.price) }}</div>
              <div>Rating: {{ course.rating.toFixed(1) }}</div>
              <div>Location: {{ course.location }}</div>
              <div>Category: {{ course.category }}</div>
              <div>Spaces: {{ course.spaces }}</div>
              <div style="margin-top:6px">
                <button @click="addToCart(course)" :disabled="course.spaces === 0">Add to Cart</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== Cart Section ===== -->
      <aside class="cart">
        <h3>Cart</h3>
        <div v-if="cartItems.length === 0" style="color: var(--muted)">Your cart is empty</div>

        <div v-for="item in cartItems" :key="item.course.id" class="cart-item">
          <div class="cart-thumb">
            <img :src="getImageUrl(item.course)" :alt="item.course.title" />
          </div>
          <div style="flex:1">
            <div style="font-weight:600">{{ item.course.title }}</div>
            <div style="font-size:13px;color:var(--muted)">{{ item.course.instructor }}</div>
            <div style="margin-top:4px">
              Qty: {{ item.qty }} × {{ formatPrice(item.course.price) }}
            </div>
          </div>
          <button style="background:var(--danger);padding:4px 8px" @click="confirmRemoveFromCart(item.course.id)">Remove</button>
        </div>

        <div class="total-row">
          <div>Total</div>
          <div>{{ formatPrice(cartTotal) }}</div>
        </div>
        <div style="margin-top:10px;display:flex;gap:6px">
          <button :disabled="cartItems.length === 0" @click="checkout">Checkout</button>
          <button class="ghost" :disabled="cartItems.length === 0" @click="clearCart">Clear</button>
        </div>
      </aside>
    </main>

    <!-- ===== Add Course Modal ===== -->
    <div v-if="showAdd" class="modal" @click.self="showAdd = false">
      <div class="modal-content">
        <h3>Add New Course</h3>
        <input v-model="newCourse.title" placeholder="Course title" />
        <input v-model="newCourse.instructor" placeholder="Instructor" />
        <input v-model="newCourse.subject" placeholder="Subject" />
        <input v-model="newCourse.location" placeholder="Location" />
        <input v-model.number="newCourse.price" type="number" placeholder="Price" />
        <input v-model.number="newCourse.rating" type="number" step="0.1" min="0" max="5" placeholder="Rating (0–5)" />
        <input v-model.number="newCourse.spaces" type="number" placeholder="Spaces available" />
        <input v-model="newCourse.category" placeholder="Category" />
        <div style="display:flex;justify-content:end;gap:8px;margin-top:10px">
          <button class="ghost" @click="showAdd = false">Cancel</button>
          <button @click="submitAdd">Add</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, reactive, computed, ref } = Vue;

    createApp({
      setup() {
        const sampleCourses = [
          { id: 1, title: "Intro to JavaScript", instructor: "John Doe", subject: "JavaScript", location: "Brazil", price: 49.99, rating: 4.5, category: "Programming", spaces: 3 },
          { id: 2, title: "Advanced CSS Design", instructor: "Jane Smith", subject: "CSS", location: "UK", price: 59.99, rating: 4.7, category: "Design", spaces: 2 },
          { id: 3, title: "Marketing 101", instructor: "Emily Johnson", subject: "Marketing", location: "London", price: 39.99, rating: 4.0, category: "Marketing", spaces: 4 },
          { id: 4, title: "Arts", instructor: "Adewala Sanya", subject: "Literature", location: "Nigeria", price: 37.99, rating: 4.2, category: "Arts", spaces: 14 },
          { id: 5, title: "Graphic Design", instructor: "Ezekiel Sanya", subject: "Design", location: "Nigeria", price: 65, rating: 4.9, category: "Design", spaces: 7 },
        ];

        const courses = reactive(sampleCourses.slice());
        const query = ref("");
        const selectedCategory = ref("");
        const selectedSort = ref("");
        const showAdd = ref(false);
        const cartItems = reactive([]);

        const newCourse = reactive({
          title: "", instructor: "", subject: "", location: "",
          price: 0, rating: 0, category: "", spaces: 0
        });

        const categories = computed(() => Array.from(new Set(courses.map(c => c.category))));

        const filteredCourses = computed(() => {
          const q = query.value.trim().toLowerCase();
          let list = courses.filter(c =>
            (!q || c.title.toLowerCase().includes(q) || c.instructor.toLowerCase().includes(q)) &&
            (!selectedCategory.value || c.category === selectedCategory.value)
          );
          switch (selectedSort.value) {
            case "title": list.sort((a, b) => a.title.localeCompare(b.title)); break;
            case "priceAsc": list.sort((a, b) => a.price - b.price); break;
            case "priceDesc": list.sort((a, b) => b.price - a.price); break;
            case "ratingDesc": list.sort((a, b) => b.rating - a.rating); break;
          }
          return list;
        });

        const cartTotal = computed(() =>
          cartItems.reduce((sum, item) => sum + item.course.price * item.qty, 0)
        );

        function addToCart(course) {
          if (course.spaces > 0) {
            course.spaces--;
            const existing = cartItems.find(i => i.course.id === course.id);
            if (existing) existing.qty++;
            else cartItems.push({ course, qty: 1 });
          } else {
            Swal.fire("No more spaces!", `The course "${course.title}" is now full.`, "warning");
          }
        }

        // ✅ Confirmation before removing from cart
        async function confirmRemoveFromCart(id) {
          const item = cartItems.find(i => i.course.id === id);
          if (!item) return;
          const result = await Swal.fire({
            title: `Remove "${item.course.title}"?`,
            text: "Are you sure you want to remove this item from your cart?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#e53e3e",
            cancelButtonColor: "#2b6cb0",
            confirmButtonText: "Yes, remove it",
            cancelButtonText: "Cancel"
          });
          if (result.isConfirmed) {
            removeFromCart(id);
          }
        }

        // Remove from cart only (no confirmation here, called after confirm)
        function removeFromCart(id) {
          const index = cartItems.findIndex(i => i.course.id === id);
          if (index !== -1) {
            const item = cartItems[index];
            item.course.spaces += item.qty;
            cartItems.splice(index, 1);
            Swal.fire("Removed!", `"${item.course.title}" was removed from your cart.`, "success");
          }
        }

        function clearCart() {
          cartItems.forEach(i => i.course.spaces += i.qty);
          cartItems.length = 0;
        }

        function checkout() {
          Swal.fire("Checkout complete!", "Thank you for your purchase!", "success");
          clearCart();
        }

        function formatPrice(value) {
          return `$${value.toFixed(2)}`;
        }

        function getImageUrl(course) {
          const seed = encodeURIComponent(`${course.title}-${course.category}-${course.id}`);
          return `https://picsum.photos/seed/${seed}/600/400`;
        }

        function submitAdd() {
          if (!newCourse.title.trim() || !newCourse.instructor.trim()) {
            Swal.fire("Error", "Please fill in the required fields.", "error");
            return;
          }
          const newId = courses.length ? Math.max(...courses.map(c => c.id)) + 1 : 1;
          courses.push({
            id: newId,
            title: newCourse.title.trim(),
            instructor: newCourse.instructor.trim(),
            subject: newCourse.subject.trim(),
            location: newCourse.location.trim(),
            price: Number(newCourse.price),
            rating: Number(newCourse.rating),
            category: newCourse.category.trim(),
            spaces: Number(newCourse.spaces)
          });
          Object.keys(newCourse).forEach(k => newCourse[k] = "");
          showAdd.value = false;
          Swal.fire("Added!", "New course added.", "success");
        }

        return {
          courses, query, selectedCategory, selectedSort, showAdd,
          newCourse, cartItems, categories, filteredCourses, cartTotal,
          addToCart, confirmRemoveFromCart, removeFromCart,
          clearCart, checkout, formatPrice, getImageUrl, submitAdd
        };
      }
    }).mount("#app");
  </script>
</body>
</html>
