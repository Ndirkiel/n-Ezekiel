<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>N-kiel Course Store</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root {
      --accent: #2b6cb0;
      --muted: #666;
      --card: #fff;
      --bg: #f6f8fb;
      --danger: #e53e3e;
    }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: #222;
    }
    .container {
      max-width: 1100px;
      margin: 24px auto;
      padding: 16px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }
    .brand { display: flex; gap: 10px; align-items: center; }
    .logo {
      width: 48px; height: 48px;
      background: linear-gradient(135deg, var(--accent), #6bb6ff);
      border-radius: 8px; display: flex;
      align-items: center; justify-content: center;
      color: #fff; font-weight: bold;
    }
    .controls { display: flex; gap: 8px; align-items: center; }
    input, select {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    button {
      background: var(--accent);
      color: #fff;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button.ghost {
      background: transparent;
      color: var(--accent);
      border: 1px solid #dbeafe;
    }
    main {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 18px;
      align-items: start;
    }
    .course-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      gap: 14px;
    }
    .card {
      background: var(--card);
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(15,23,42,0.06);
      display: flex;
      flex-direction: column;
    }
    .course-image img {
      width: 100%;
      height: 140px;
      border-radius: 8px;
      object-fit: cover;
    }
    .course-info {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-top: 6px;
    }
    .course-title { font-weight: 600; font-size: 14px; }
    .course-instructor { font-size: 13px; color: var(--muted); }
    .price { color: var(--accent); font-weight: bold; }
    .cart {
      background: var(--card);
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(15,23,42,0.06);
      max-height: 80vh;
      overflow: auto;
    }
    .cart-item { display: flex; gap: 10px; margin-bottom: 10px; }
    .cart-thumb img {
      width: 56px; height: 72px;
      border-radius: 6px; object-fit: cover;
    }
    .total-row {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      margin-top: 10px;
    }

    /* Modal styles */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      max-width: 90%;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media (max-width: 900px) { main { grid-template-columns: 1fr; } }
  </style>
</head>

<body>
  <div id="app" class="container">
    <header>
      <div class="brand">
        <div class="logo">NK</div>
        <div>
          <div style="font-weight:700">N-kiel Course Store</div>
          <div style="font-size:12px;color:var(--muted)">Single-page demo</div>
        </div>
      </div>

      <div class="controls">
        <input type="search" v-model="query" placeholder="Search..." />
        <select v-model="selectedCategory">
          <option value="">All categories</option>
          <option v-for="c in categories" :key="c">{{ c }}</option>
        </select>
        <button @click="showAdd = true">Add Course</button>
      </div>
    </header>

    <main>
      <section>
        <div style="margin-bottom:10px;font-weight:600">{{ filteredCourses.length }} courses found</div>

        <div class="course-grid">
          <div class="card" v-for="course in filteredCourses" :key="course.id">
            <div class="course-image">
              <img :src="getImageUrl(course.id, course.subject)" :alt="course.title" />
            </div>
            <div class="course-info">
              <div class="course-title">{{ course.title }}</div>
              <div class="course-instructor">by {{ course.instructor }}</div>
              <div class="price">{{ formatPrice(course.price) }}</div>
              <div>Subject: {{ course.subject }}</div>
              <div>Location: {{ course.location }}</div>
              <div>Spaces: {{ course.spaces }}</div>
              <div style="margin-top:6px;display:flex;gap:6px">
                <button @click="addToCart(course)" :disabled="course.spaces===0">Add</button>
                <button style="background:#e53e3e" @click="removeCourse(course.id)">Remove</button>
              </div>
            </div>
          </div>
        </div>

        <div v-if="filteredCourses.length===0" style="padding:10px;text-align:center;color:var(--muted)">
          No courses found
        </div>
      </section>

      <aside class="cart">
        <h3>Cart</h3>
        <div v-if="cartItems.length===0" style="color:var(--muted)">Your cart is empty</div>

        <div v-for="item in cartItems" :key="item.course.id" class="cart-item">
          <div class="cart-thumb">
            <img :src="getImageUrl(item.course.id, item.course.subject)" :alt="item.course.title" />
          </div>
          <div>
            <div style="font-weight:600">{{ item.course.title }}</div>
            <div style="font-size:13px;color:var(--muted)">{{ item.course.instructor }}</div>
            <div style="margin-top:4px">
              Qty: {{ item.qty }} × {{ formatPrice(item.course.price) }}
            </div>
          </div>
        </div>

        <div class="total-row">
          <div>Total</div>
          <div>{{ formatPrice(cartTotal) }}</div>
        </div>

        <div style="margin-top:10px;display:flex;gap:6px">
          <button :disabled="cartItems.length===0" @click="checkout">Checkout</button>
          <button class="ghost" :disabled="cartItems.length===0" @click="clearCart">Clear</button>
        </div>
      </aside>
    </main>

    <!-- ✅ Add Course Modal -->
    <div v-if="showAdd" class="modal">
      <div class="modal-content">
        <h3>Add New Course</h3>
        <input v-model="newCourse.title" placeholder="Course title" />
        <input v-model="newCourse.instructor" placeholder="Instructor" />
        <input v-model="newCourse.subject" placeholder="Subject" />
        <input v-model="newCourse.location" placeholder="Location" />
        <input v-model.number="newCourse.price" type="number" placeholder="Price" />
        <input v-model.number="newCourse.spaces" type="number" placeholder="Spaces available" />
        <input v-model="newCourse.category" placeholder="Category" />
        <div style="display:flex;justify-content:end;gap:8px;margin-top:10px">
          <button class="ghost" @click="showAdd=false">Cancel</button>
          <button @click="submitAdd">Add</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, reactive, computed, toRefs, watch } = Vue;

    createApp({
      setup() {
        const sampleCourses = [
          { id: 1, title: "JavaScript Basics", instructor: "Jane Doe", subject: "JavaScript", location: "Nigeria", price: 200, rating: 4.8, category: "Programming", spaces: 5 },
          { id: 2, title: "Vue.js Deep Dive", instructor: "John Smith", subject: "JavaScript", location: "USA", price: 150, rating: 4.7, category: "Programming", spaces: 10 },
          { id: 3, title: "Graphic Design Fundamentals", instructor: "Alice Johnson", subject: "Design", location: "UK", price: 120, rating: 4.6, category: "Design", spaces: 7 },
          { id: 4, title: "Digital Marketing 101", instructor: "Bob Lee", subject: "Marketing", location: "Canada", price: 100, rating: 4.5, category: "Marketing", spaces: 3 },
          { id: 5, title: "The Gods Are Not to Be Blame", instructor: "Adewale Sanya", subject: "Arts", location: "Nigeria", price: 145, rating: 4.7, category: "Arts", spaces: 12 },
        ];

        const persistedCourses = JSON.parse(localStorage.getItem("courses_v1") || "null");
        const courses = reactive(persistedCourses?.length ? persistedCourses : sampleCourses.slice());

        const initialCart = JSON.parse(localStorage.getItem("cart_v1") || "[]");
        const cart = reactive(initialCart.map(it => ({
          course: courses.find(c => c.id === it.courseId) || courses[0],
          qty: it.qty,
        })));

        const state = reactive({
          query: "",
          selectedCategory: "",
          showAdd: false,
          newCourse: { title: "", instructor: "", subject: "", location: "", price: 0, rating: 4, category: "", spaces: 0 },
        });

        const categories = computed(() => Array.from(new Set(courses.map(c => c.category))));
        const filteredCourses = computed(() => {
          const q = state.query.trim().toLowerCase();
          return courses.filter(c =>
            (!q || c.title.toLowerCase().includes(q) || c.instructor.toLowerCase().includes(q)) &&
            (!state.selectedCategory || c.category === state.selectedCategory)
          );
        });

        const formatPrice = n => new Intl.NumberFormat(undefined, { style: "currency", currency: "USD" }).format(n);
        const saveCourses = () => localStorage.setItem("courses_v1", JSON.stringify(courses));
        const saveCart = () => localStorage.setItem("cart_v1", JSON.stringify(cart.map(it => ({ courseId: it.course.id, qty: it.qty }))));

        function addToCart(course) {
          if (course.spaces <= 0) return alert("No spaces left");
          const existing = cart.find(it => it.course.id === course.id);
          if (existing) existing.qty++;
          else cart.push({ course, qty: 1 });
          course.spaces--;
          saveCart(); saveCourses();
        }

        function clearCart() { cart.splice(0, cart.length); saveCart(); }
        function checkout() { Swal.fire("Checkout complete!", "Thank you!", "success"); cart.splice(0, cart.length); saveCart(); }

        function removeCourse(id) {
          const idx = courses.findIndex(c => c.id === id);
          if (idx >= 0) {
            courses.splice(idx, 1);
            saveCourses();
            Swal.fire({ title: "Deleted!", text: "Course removed.", icon: "success", timer: 1200, showConfirmButton: false });
          }
        }

        function submitAdd() {
          const nc = { ...state.newCourse };
          if (!nc.title || !nc.instructor) return Swal.fire("Error", "Please fill in required fields!", "error");
          nc.id = courses.length ? Math.max(...courses.map(c => c.id)) + 1 : 1;
          courses.push(nc);
          saveCourses();
          state.newCourse = { title: "", instructor: "", subject: "", location: "", price: 0, rating: 4, category: "", spaces: 0 };
          state.showAdd = false;
          Swal.fire("Success!", "New course added!", "success");
        }

        const cartItems = computed(() => cart);
        const cartTotal = computed(() => cart.reduce((s, it) => s + it.course.price * it.qty, 0));

        function getImageUrl(courseId, subject) {
          const seed = encodeURIComponent(subject || "learning") + "-" + courseId;
          return `https://picsum.photos/seed/${seed}/600/400`;
        }

        watch(courses, saveCourses, { deep: true });

        return { ...toRefs(state), courses, categories, filteredCourses, cartItems, cartTotal,
                 addToCart, clearCart, checkout, removeCourse, submitAdd, getImageUrl, formatPrice };
      }
    }).mount("#app");
  </script>
</body>
</html>
